<?xml version="1.0"?>
<Denemo>
  <merge>
    <title>A Denemo Keymap</title>
    <author>AT, JRR, RTS</author>
    <map>
      <row>
        <action>LineOrSpace</action>
        <scheme>;;;;;;;;;;;;;;;
;;LineOrSpace
;; tests note name recognition.
(let (
      (shiftup 0)
      (shiftdown 0)
      (runtest 0)
      (notewas #t)
      (userinput #t)
      (score 0)
      (steps 0)
      (starttime 0)
      (position 0)
      (endtime 0)
      (span 8) ;; how many steps of the scale to test.
      (num-goes 10) ;; how many notes to present for the whole test
      )
  ;; set the random seed up using time of day
  (let ((time (gettimeofday)))
    (set! *random-state*
	  (seed-&gt;random-state (+ (car time)
				 (cdr time)))))
  (set! shiftup
	(lambda (n)
	  (if (&gt; n 0) (begin
	  		(d-CursorUp)
			(set! position (+ position 1))
			(shiftup (- n 1))))))

  (set! shiftdown
	(lambda (n)
	  (if (&gt; n 0) (begin
	  		(d-CursorDown)
			(set! position (- position 1))
			(shiftdown (- n 1))))))
;;;;;;;; the main function to run the test
  (set! runtest 
	(lambda (n)
	  (if (&gt; n 0) (begin
			(set! steps (+ 1 (random span)))
			(shiftup steps)
			(d-Insert2)
			
			(if (odd? position)
			   (begin
				(set! notewas "s"))
			   (begin
				(set! notewas "l")))
			;;(d-InsertLilyDirective "directive=%Your score so far: ")
			(d-DirectivePut-score-display "LineOrSpace" (string-append (string-append  "Score: " (object-&gt;string score)) ". Name this note"))
			(shiftdown steps)
			(set! userinput  (d-GetChar)
			      )
			(if (string? userinput)
			    (begin
			      ;;(d-DeletePreviousObject)
			      (if  (string=? notewas userinput)
				   (begin
				     (set! score (+ score 1))
				     (d-ChangeNotehead "Diamond"))
				   (begin
				     (set! score (- score 1))
				     (d-ChangeNotehead "Cross"))) 		 
			      (runtest (- n 1))))))))

  (d-PlayMidiKey #xF03001)
  (d-PlayMidiKey #xF02A01)
  (d-PlayMidiKey #xF04001)
  (set! num-goes (d-GetUserInput "Line/Space Test - Instructions" "For each note, hit *l* if it is on a line and *s* if it is on a space.\nHow many goes do you want?" "8"))
  (set! starttime (car (gettimeofday)))
  (d-NewWindow)
  (set! num-goes (string-&gt;number num-goes))
  (if (not (integer? num-goes))
      (set! num-goes 10))
  (runtest num-goes)
  (d-DirectivePut-score-display  "LineOrSpace"  (string-append  "Final Score: " (object-&gt;string score)))
  (set! endtime (car (gettimeofday))) 
  (display (- endtime starttime))
  (d-RefreshDisplay)
  (d-PlayMidiKey #xF03001)
  (d-PlayMidiKey #xF02A01)
  (d-PlayMidiKey #xF04001)
  )
;;;;;;;;;;;;;;;;;;;;;;;;;;

</scheme>
        <label>Line and space recognition</label>
        <tooltip>%tests your ability to recognize the difference between line and space</tooltip>
      </row>
    </map>
  </merge>
</Denemo>
