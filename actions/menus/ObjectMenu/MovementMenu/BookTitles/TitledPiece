<?xml version="1.0"?>
<Denemo>
  <merge>
    <title>A Denemo Keymap</title>
    <author>AT, JRR, RTS</author>
    <map>
      <row>
        <after>Piece</after>
        <action>TitledPiece</action>
        <scheme>;;;TitledPiece
(d-LilyPondInclude "book-titling.ily")
(d-LilyPondInclude "simplified-book-titling.ily")
(let ((tag "TitledPiece") (chapter (d-DirectiveGet-movementcontrol-display "TitledPiece")))
  (if (not chapter)
    (set! chapter "Movement Title"))
  (set! chapter (d-GetUserInput "Movement Title" "Give a title for the current movement\nOr blank to delete" chapter))
  (if chapter
    (begin
      (d-SetSaved #f)
      (if (string-null? chapter)
      	(d-DirectiveDelete-movementcontrol tag)
        (begin 
        	(d-DirectivePut-movementcontrol-prefix tag (string-append "\\titledPiece \\markup \"" chapter "\"\n"))
        	(d-DirectivePut-movementcontrol-display tag chapter))))
    (d-WarningDialog "Movement Title unchanged")))
</scheme>
        <label>Title</label>
        <tooltip>Prints a title for the movement, which will get a page reference in a table of contents.</tooltip>
      </row>
    </map>
  </merge>
</Denemo>
