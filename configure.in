dnl Process this file with autoconf to produce a configure script.
AC_INIT(src)
AC_CANONICAL_SYSTEM
AM_INIT_AUTOMAKE(denemo, 0.7.9)
AM_CONFIG_HEADER(config.h)

AM_MAINTAINER_MODE
dnl AM_BINRELOC
dnl ALL_LINGUAS="es fr sv"
AM_GNU_GETTEXT([external])
AM_GNU_GETTEXT_VERSION


dnl Checks for programs.
AC_PROG_CC
AC_PROG_CPP
AC_PROG_CXX
AC_PROG_INSTALL
AC_PROG_YACC
AM_PROG_LEX

dnl AM_DISABLE_STATIC
AM_PROG_LIBTOOL

dnl GTK_DOC_CHECK([1.0])
dnl AC_ARG_ENABLE(
dnl   gtk-doc,
dnl   [  --enable-gtk-doc		Use gtk-doc to build documentation [
dnl default=auto]], enable_gtk_doc="$enableval", enable_gtk_doc=auto)
dnl if test x$enable_gtk_doc = xauto ; then
dnl   if test x$GTKDOC = xtrue ; then
dnl     enable_gtk_doc=yes
dnl   else
dnl     enable_gtk_doc=no
dnl   fi
dnl fi
dnl AM_CONDITIONAL(ENABLE_GTK_DOC, test x$enable_gtk_doc = xyes)
dnl AM_CONDITIONAL(GTK_DOC_USE_LIBTOOL, no)

dnl turnoff binreloc by default
dnl $br_cv_binreloc=no


dnl Checks for libraries.
dnl Why asking if gtk is enabled when it's required anyway?
dnl usegtk2=yes
dnl AC_ARG_ENABLE(
dnl   gtk2,
dnl   [  --enable-gtk2		Use GTK2 "[default=yes]"],
dnl   [
dnl     if test "x$enable_gtk2" != "xno"; then
dnl       usegtk2=yes
dnl     fi
dnl   ])


PKG_CHECK_MODULES(GTK2, gtk+-2.0 >= 2.0.3)
CFLAGS="$GTK2_CFLAGS"
LIBS="$GTK2_LIBS"

#PKG_CHECK_MODULES(LIBGUILE, libguile >= ???)
#CFLAGS="LIBGUILE_CFLAGS"
#LIBS="$LIBGUILE_LIBS"
LIBS="$LIBS -llibguile"

PKG_CHECK_MODULES(LIBAUBIO, aubio >= 0.3.2)
CFLAGS="$CFLAGS $LIBAUBIO_CFLAGS"
LIBS="$LIBS $LIBAUBIO_LIBS"

PKG_CHECK_MODULES(PORTAUDIO, portaudio-2.0 >= 19)
dnl CFLAGS="$CFLAGS $PORTAUDIO_CFLAGS"
LIBS="$LIBS $PORTAUDIO_LIBS"



#dnl PKG_CHECK_MODULES(PORTAUDIO, portaudio >= 18)
#dnl CFLAGS="$CFLAGS $PORTAUDIO_CFLAGS"
#LIBS="$LIBS libportaudio.a"
#LIBS="$LIBS -lportaudio"


AM_PATH_XML2(
  2.0.0,
  [
    LIBS="$LIBS $XML_LIBS"
    CPPFLAGS="$CPPFLAGS $XML_CPPFLAGS"
    LDFLAGS="$LDFLAGS $XML_LDFLAGS"
  ],
  AC_MSG_ERROR(Cannot find libxml: Is xml-config in path?))


#usealsa=no
#AC_ARG_ENABLE(
#  alsa,
#  AC_HELP_STRING([--enable-alsa], [use ALSA @<:@default=no@:>@]),
#  [
#    if test "x$enableval" != "xno"; then
#      usealsa=yes
#    fi
#  ])

#if test "x$usealsa" = "xyes"; then
#  AM_PATH_ALSA(
#    0.9.0,
#    [
#      LIBS="$LIBS $ALSA_LIBS"
#      CFLAGS="$CFLAGS -DHAVEALSA $ALSA_CFLAGS"
#      LDFLAGS="$LDFLAGS $ALSA_LDFLAGS"
#    ],
#    AC_MSG_ERROR(Cannot find Alsa))
#  AC_DEFINE(HAVEALSA, 1,[Use alsa])
#fi


dnl Options for configuration
build_debug=no
AC_ARG_ENABLE(
  debug,
  AC_HELP_STRING([--enable-debug], [enable debug code @<:@default=no@:>@]),
  [
    if test "x$enableval" != "xno"; then
      build_debug=yes
      CFLAGS="$CFLAGS -DDEBUG -g"
      CXXFLAGS="$CXXFLAGS -DDEBUG -g"
    fi
  ])


dnl Memory debugging
mem_debug=no
AC_ARG_ENABLE(
  mem,
  AC_HELP_STRING([--enable-mem], [enable memory debugging @<:@default=no@:>@]),
  [
    if test "x$enableval" != "xno"; then
      mem_debug=yes
    fi
  ])
if test "x$mem_debug" = "xyes"; then LDFLAGS="$LDFLAGS -lefence"; fi


dnl Build documentation
build_doc=no
AC_ARG_ENABLE(
  doc,
  AC_HELP_STRING(
    [--enable-doc],[enable documentation build @<:@default=no@:>@]),
  [
    if test "x$enableval" != "xno"; then
      build_doc=yes
    fi
  ])
AM_CONDITIONAL(DENEMO_BUILD_DOC,[test "$build_doc" = "yes"])


#dnl Build plugins
#DENEMO_PLUGINS_ALL="analysis rumour midiinput"
#AC_SUBST(DENEMO_PLUGINS_ALL)
#DENEMO_PLUGINS_SELECTED=""
#AC_ARG_WITH(
#  plugins,
#  AC_HELP_STRING(
#    [--with-plugins], [comma-separated list of plug-ins to compile]),
#    [
#      for i in `echo $withval | tr , ' '`; do
#        if test -n `echo $i | grep $DENEMO_PLUGINS_ALL`; then
#          DENEMO_PLUGINS_SELECTED="$DENEMO_PLUGINS_SELECTED $i"
#        else
#          echo "plug-in $i not recognized, ignoring..."
#        fi
#      done
#    ],
#    [DENEMO_PLUGINS_SELECTED=""])
#AC_SUBST(DENEMO_PLUGINS_SELECTED)

dnl Replace `main' with a function in -libs:



dnl Checks for header files.

AC_CHECK_HEADERS(sys/soundcard.h)
AC_CHECK_HEADERS(errno.h)
AC_CHECK_HEADERS(getopt.h sys/wait.h wait.h sys/time.h sys/resource.h)

AC_TRY_COMPILE(
  [#include <signal.h>], [int mysignal = SIGCHLD;],
  [AC_DEFINE(HAVE_SIGCHLD, 1, [Define to 1 if SIGCHLD signal is available])])

AC_TRY_LINK(
  [#include <stdio.h>],
  [
    FILE * fp;
    flockfile (fp);
    ftrylockfile (fp);
    funlockfile (fp);
  ],
  [AC_DEFINE(HAVE_FILE_LOCKS, 1, [Define to 1 if file locking is available])])

dnl Checks for typedefs, structures, and compiler characteristics.
dnl AC_HEADER_TIME

dnl Checks for library functions.

dnl Set PACKAGE_LOCALE_DIR in config.h.


if test "${prefix}" == "NONE"; then
  prefix=${ac_default_prefix}
  AC_SUBST(prefix)
fi

pkgdatadir=${datadir}/${PACKAGE}
PACKAGE_DATA_DIR=${datadir}/${PACKAGE}
AC_SUBST(pkgdatadir)
AC_SUBST(PACKAGE_DATA_DIR)
dnl Set PACKAGE_PLUGIN_DIR in Makefiles and config.h.
PACKAGE_PLUGIN_DIR=$libdir/denemo
AC_SUBST(PACKAGE_PLUGIN_DIR)
if test "x${prefix}" = xNONE; then
  denemo_plugin_dir="${ac_default_prefix}/lib/${PACKAGE}"
else
  denemo_plugin_dir="${prefix}/lib/${PACKAGE}"
fi
 
dnl
dnl Force sysconfdir=/etc if no --sysconfdir=xxx passed
dnl
if test $sysconfdir = $\{prefix\}/etc; then
  sysconfdir=/etc/${PACKAGE}
else 
  sysconfdir=$sysconfdir/${PACKAGE}    
fi
AC_SUBST(sysconfdir)

AC_DEFINE_UNQUOTED(
  PACKAGE_PLUGIN_DIR, "$denemo_plugin_dir", [set plugin dir])

dnl Set PACKAGE_SOURCE_DIR in config.h.
packagesrcdir=`cd $srcdir && pwd`
AC_DEFINE_UNQUOTED(
  PACKAGE_SOURCE_DIR, "${packagesrcdir}", [set package source dir])


dnl GTK_DOC_CHECK([1.4])


dnl Gettext stuff

AC_SUBST(CFLAGS)
AC_SUBST(CPPFLAGS)
AC_SUBST(LDFLAGS)


AC_OUTPUT(
[
  m4/Makefile 
  Makefile 
  denemo.spec
  src/Makefile 
  pixmaps/Makefile 
  doc/Makefile
  doc/transformations/Makefile
  doc/images/Makefile
  keymaps/Makefile
  po/Makefile.in
  fonts/Makefile
  examples/Makefile
  templates/Makefile
  templates/band/Makefile
  templates/chamber/Makefile
  templates/choral/Makefile
  templates/jazz/Makefile
])
